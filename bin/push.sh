#!/bin/bash

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ ‚Äî –≤–µ—Ç–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
BRANCH_DEFAULT="main"

# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
BRANCH=${1:-$BRANCH_DEFAULT}

echo "=== –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ ==="
echo "–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Ç–∫—É: $BRANCH"

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
REPOS=$(git remote)

SUCCESS_COUNT=0
FAILED_COUNT=0

for REMOTE in $REPOS; do
    echo ""
    echo "–ü—É—à–∏–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π $REMOTE –Ω–∞ –≤–µ—Ç–∫—É $BRANCH..."

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    if ! git ls-remote "$REMOTE" &> /dev/null; then
        echo "‚ùå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π $REMOTE –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º..."
        ((FAILED_COUNT++))
        continue
    fi

    # –í—ã–ø–æ–ª–Ω—è–µ–º –ø—É—à
    if git push "$REMOTE" "$BRANCH"; then
        echo "‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ $REMOTE"
        ((SUCCESS_COUNT++))
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É—à –≤ $REMOTE"
        ((FAILED_COUNT++))
    fi
done

echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
echo "‚úÖ –£—Å–ø–µ—à–Ω–æ: $SUCCESS_COUNT —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤"
echo "‚ùå –ù–µ—É–¥–∞—á–Ω–æ: $FAILED_COUNT —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤"
echo "=== –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ==="